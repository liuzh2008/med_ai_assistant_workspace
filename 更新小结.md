### 2026-03-01 22:00
#### 版本号：v0.4.017，更新：
- 临时医嘱重复导入问题修复：修改LongTermOrderRepository.existsActiveOrder()判重逻辑，添加(:repeatIndicator=0 OR lto.stopTime IS NULL)条件区分临时医嘱和长期医嘱，解决临时医嘱stopTime有值导致判重失效的问题，同时保留长期医嘱停止后再次下达的业务灵活性，提升判重日志级别到INFO并添加详细参数输出

### 2026-03-01 16:45
#### 版本号：v0.4.015（后端）、v0.4.016（前端），更新：
- 病历记录时间时区问题全面修复：后端MedicalRecord实体类添加@JsonFormat注解指定GMT+8时区，前端handleRecordClick和handleEMRRecordClick方法改用本地时间手动格式化替代toISOString()，解决新建/点击病历记录时间少8小时的UTC时区转换问题

### 2026-03-01 16:30
#### 版本号：v0.4.016，更新：
- 前端病历记录日期显示时区修复：修复handleRecordClick和handleEMRRecordClick方法中使用toISOString()导致日期控件显示UTC时间的问题，改用本地时间手动格式化（年-月-日 时:分:秒），确保日期控件显示与用户当前时区一致，解决点击记录时日期少8小时的显示问题

### 2026-03-01 14:30
#### 版本号：v0.4.014，更新：
- 待办事项生成LLM调用方式优化：重构TodoGenerationService，移除PromptService和PromptTemplateRepository依赖，直接调用/api/ai/response接口，参考AI完善按钮实现方式，避免数据源混淆和复杂依赖链，简化调用逻辑，提升代码可维护性和稳定性；发现生产环境缺少todo_item表

### 2026-03-01 10:30
#### 版本号：0.4.013，更新：
- LLM调用统一抽象：在ai.js中新增analyzeLLM通用LLM分析方法作为非流式调用统一入口，重构voiceTextProcessor.js使用analyzeLLM替代直接request调用，减少代码重复约18行，符合项目LLM调用规范

### 2026-02-28 21:30
#### 版本号：0.4.012，更新：
- 病人列表加载性能优化（检查报告懒加载）：实施懒加载策略将检查报告改为按需加载（只在用户点击"检查"标签页时加载），添加完整性能监控日志系统（PatientList/MedicalRecords/LabTests/ExaminationReports/PatientView/PatientTabs/Store），病人列表加载从5-10秒降至151ms（提速97%），选中病人加载从4-17秒降至355ms（提速91-98%），避免检查报告3次重复调用节省11-51秒，用户体验显著提升

### 2026-02-28 18:41
#### 版本号：0.4.011，更新：
- 待办事项页面布局优化：实现左右分栏独立滚动（两侧各自添加overflow-y:auto），页面高度使用100vh视口高度而非固定像素值，移除卡片min-height限制实现高度自适应，移除内部滚动限制实现内容完整显示，提升用户浏览体验，更新Memory Bank记忆

### 2026-02-28 19:30
#### 版本号：0.4.010，更新：
- 前端执行服务器地址配置更正：修正.env.development和src/api/request.js中执行服务器地址从100.66.1.2:8082更新为100.66.1.3:8082，通过curl验证服务器可用性，解决前端调用执行服务器接口ERR_EMPTY_RESPONSE网络错误

### 2026-02-28 17:15
#### 版本号：0.4.009，更新：
- 执行服务器启动失败修复：移除run-execution-server.bat中的execution profile配置（仅用于生产环境需GitHub配置），修正application.properties中执行服务器配置（execution.server.host/oracle-port/api-url）从生产环境（nb.nblink.cc:16601）改为开发环境（100.66.1.3:1521），解决GitHub Release配置缺失和数据库连接错误问题

### 2026-02-28 16:30
#### 版本号：0.4.008，更新：
- 开发环境执行服务器切换：将执行服务器从100.66.1.2切换到100.66.1.3，修改application.properties、application-execution.properties和application-integration.properties三个配置文件，生产环境配置（nb.nblink.cc）保持不变，确保开发测试与生产环境完全隔离

### 2026-02-28 14:37

#### 版本号：0.4.007，更新：

- 待办事项页面“原始记录”功能实现与优化：新增前端API方法getMedicalRecordById()通过病历ID获取单条病历记录，实现点击按钮显示完整病历内容（记录类型/时间/医生/内容），修复Vue模板字符串错误使用this导致运行时错误，修复Element UI对话框点击x按钮产生cancel错误（添加.catch()捕获），优化卡片高度自适应布局解决浏览器渲染冲突，更新接口文档和JSDoc注释

### 2026-02-28 11:52
#### 版本号：0.4.006，更新：
- 患者信息工具函数提取与代码复用：将性别格式化函数从PatientInfo.vue和TodoView.vue提取到patientUtils.js，新增formatPatientGender()工具函数支持多种性别编码格式（数字/字符串/字母），净减少代码约10行，统一性别格式化逻辑，添加完整JSDoc注释，提升代码可维护性和一致性，更新Memory Bank记忆

### 2026-02-28 00:38
#### 版本号：0.4.005，更新：
- 待办事项页面按科室加载功能实现：完成前端TodoView页面病人待办列表自动加载，对接后端GET /api/medicalrecords/todos/by-date-department接口，实现按病人ID汇总待办（使用Map数据结构合并同一病人多条待办），页面加载时自动获取用户科室并生成病人卡片（按床号升序），更新getTodosByDepartment() API方法，临时禁用专业组筛选，完善JSDoc注释

### 2026-02-28 00:30
#### 版本号：0.4.004，更新：
- 根据日期和科室查询待办事项接口：新增GET /api/medicalrecords/todos/by-date-department接口，支持按日期（yyyy-MM-dd）和科室名称查询当天生成的待办事项，按床号升序排列，自动过滤已删除病历，创建280行完整接口文档，添加106行详细JSDoc注释，用于科室每日工作清单管理

### 2026-02-27 23:50
#### 版本号：0.4.003，更新：
- 待办事项查询逻辑修复：修复根据患者ID查询待办事项接口返回已删除病历记录问题，新增Repository方法findByPatientIdExcludingDeletedRecords使用JPQL JOIN过滤is_deleted=1的病历，更新Controller和接口文档，测试验证通过

### 2026-02-27 23:11
#### 版本号：0.4.001，更新：
- 新增根据病历记录ID获取待办事项接口：实现GET /api/medicalrecords/todo/{medicalRecordId}接口，返回指定病历的所有待办事项列表及数量统计，添加完整JSDoc注释（56行），创建接口文档（177行），前端版本号同步更新

### 2026-02-27 22:43
#### 版本号：0.3.016，更新：
- 病历待办事项生成功能AI调用优化：在TodoGenerationService中使用自定义简化系统提示词替代深度推理协议，新增PromptService.analyzePromptContentWithCustomSystem()方法支持自定义系统提示词，减少Token消耗和响应时间，更新接口文档，添加JSDoc注释

### 2026-02-27 16:00
#### 版本号：v0.3.018，更新：
- 病历待办事项生成功能文档完善：创建完整实施方案文档（819行）和TDD测试指南文档（1484行），涵盖需求分析、数据库设计、后端/前端实现、完整测试策略（单元+集成+E2E+性能测试）、Mock策略、CI/CD集成，为功能开发提供完整技术路线图

### 2026-02-27 14:45
#### 版本号：v0.3.017，更新：
- 确认病历时间显示修复完成：验证MedicalRecords组件createRecord()方法已正确使用本地时间手动格式化（非toISOString()），新建病历时记录时间正确显示为当前本地时间，无UTC时区偏移问题

### 2026-02-27 13:30
#### 版本号：v0.3.016，更新：
- 全面修复病历时间显示错误：修复MedicalRecords组件中fetchRecords()、handleRecordClick()、handleEMRRecordClick()三个方法的时间格式化问题，将所有toISOString()改为本地时间手动格式化，彻底解决从数据库加载病历、点击病历记录、点击EMR病历记录时显示时间比实际少8小时的问题

### 2026-02-27 12:00
#### 版本号：0.3.014，更新：
- 部署脚本增加服务自启功能：修改deploy/main-linux-oracle/deploy.sh和deploy/main-linux-testServer/deploy.sh，在健康检查通过后自动检测并启动执行服务器轮询、主服务器提交、主服务器轮询、Prompt自动生成四个核心服务，实现部署后服务自动启用无需手动干预

### 2026-02-27 11:55
#### 版本号：v0.3.013，更新：
- 修复新建病历时间显示错误：将createRecord()方法中的toISOString()改为使用本地时间手动格式化，解决UTC时间导致显示时间比实际时间少8小时的问题，确保新建病历时记录时间正确显示为当前本地时间；为createRecord()方法添加完整JSDoc注释

### 2026-02-26 23:59
#### 版本号：v0.3.012，更新：
- 病历待办事项生成功能 TDD 实施完成：按照红-绿-重构流程完成数据访问层（PatientTodoItem 实体和仓库，8 个测试）、服务层（TodoGenerationService，14 个测试）、REST API 层（AIController 增强 + PatientTodoController 新建，9 个集成测试），共 22 个单元测试全部通过，新增 5 个病历待办事项相关接口

### 2026-02-26 23:45
#### 版本号：v0.3.012，更新：
- 病历待办事项生成功能 TDD 实施指南完成：生成 1717 行完整 TDD 指南文档，包含 3 个用户故事、7 个开发任务、8 类边界场景测试、完整代码示例和质量保障体系；同时完成方案文档 4 项关键优化（Prompt 模板格式、兜底逻辑、测试用例、前端依赖版本）

### 2026-02-26 20:23
#### 版本号：0.3.011，更新：
- 修复开发环境启动失败问题（Bean定义重复）：移除GitHubReleaseProperties的@Configuration注解和GitHubReleaseClient的@Service注解，在GitHubReleaseClientConfig中添加@EnableConfigurationProperties启用配置类，解决Spring容器Bean定义重复冲突

### 2026-02-26 23:15
#### 版本号：0.3.011，更新：
- GitHub Release下载服务及配置类TDD实现：完成GitHubReleaseClient Service（使用WebClient异步下载、本地缓存机制、12个单元测试全部通过），创建GitHubReleaseProperties配置类（从环境变量注入Token和缓存路径）和GitHubReleaseClientConfig（仅execution profile生效），配置类测试优化从SpringBootTest改为纯单元测试（速度提升1000倍），完整JavaDoc注释和配置示例文件

### 2026-02-26 16:43
#### 版本号：v0.3.010，更新：
- Docker永久化配置实施及 BuildFileTestController 增强：修改执行服务器 docker-compose.yml 添加 /medai/build-files 目录挂载（支持 Linux 和 Windows），增强 BuildFileTestController 自动检测操作系统选择正确路径，生成接口文档和部署指南

### 2026-02-26 21:20
#### 版本号：v0.3.009，更新：
- GitHub自动构建与执行服务器文件下载验证：验证GitHub Actions构建能力、执行服务器网络连通性与私有仓库访问能力，实现执行服务器文件下载测试API（/api/build-files/test/{filename}），生成端到端自动化发布方案文档和验证记录文档

### 2026-02-26 16:30
#### 版本号：v0.3.008，更新：
- 修复诊断替换接口日期格式解析错误：ReplaceDiagnosisDTO添加@JsonFormat注解支持ISO 8601日期格式，解决前端使用toISOString()生成日期时的400错误

### 2026-02-25 13:50
#### 版本号：v0.3.007，更新：
- 修复Prompt轮询服务数据一致性Bug：重构事务边界确保PromptResult创建、Prompt状态更新、STATUS标记在同一事务中，增加数据一致性检查验证PromptResult存在性，实现自动恢复和补偿机制，解决97条历史问题记录

### 2026-02-24 19:45
#### 版本号：v0.3.006，更新：
- AI对话功能模型配置化改造：将硬编码的模型名称改为从环境变量读取，开发环境使用deepseek-chat生产环境使用inHospitalDeepseek，优化aiService.js错误处理逻辑正确处理字符串类型错误，添加详细调试日志

### 2026-02-24 17:30
#### 版本号：v0.3.005，更新：
- 修复前端部署端口冲突问题：部署脚本增强容器清理逻辑，使用docker-compose down --remove-orphans清理所有容器，添加8080端口占用检测并显示进程信息，同步更新生产和测试服务器部署脚本

### 2026-02-24 14:28
#### 版本号：v0.3.004，更新：
- 修复手术任务创建日期解析错误：在SurgeryTaskDTO中添加@JsonFormat注解支持纯日期字符串反序列化，添加详细JavaDoc注释，解决前端使用"yyyy-MM-dd"格式日期时的400错误

### 2026-02-24 09:15

#### 版本号：v0.3.003，更新：

- 前端构建脚本增强缓存清理逻辑：使用PowerShell强制删除.cache目录，检测并修复损坏的依赖，优化依赖安装流程，解决Windows环境下npm缓存清理失败问题

### 2026-02-23 12:15
#### 版本号：v0.3.002，更新：
- 病历记录页面布局优化：将记录类型、记录时间、记录医生放到同一行

### 2026-02-23 12:10
#### 版本号：v0.3.002，更新：
- 小屏界面功能：适配7-8英寸设备，系统菜单添加小屏模式开关，小屏模式下病人列表和Prompt模板列表默认隐藏，通过菜单控制显示，选择后自动隐藏

### 2026-02-22 23:55
#### 版本号：v0.3.001，更新：
- 语音识别后LLM文字整理功能：语音识别结束后自动调用LLM整理文字，解析修改后记录和修改原因分别显示到病历输入框和修改原因框；新增LLM模型环境变量配置；修复vue.config.js代理配置

### 2026-02-22 22:40
#### 版本号：v0.3.000，更新：
- 实时语音识别端到端集成完成：集成DashScope SDK 2.22.9，后端实现音频数据转发到阿里云百炼ASR服务（paraformer-realtime-v2），识别结果实时推送到前端病历输入框；修复Spring MVC/WebFlux冲突、CORS跨域、多数据源冲突等问题

### 2026-02-22 19:05
#### 版本号：v0.2.108，更新：
- 病历记录实时语音识别前端功能：使用AudioContext采集麦克风音频，通过WebSocket实时发送PCM数据，识别结果自动追加到病历内容

### 2026-02-22 18:40
#### 版本号：v0.2.107，更新：
- 实时语音识别WebSocket后端TDD实施完成：按照红-绿-重构流程完成3个核心任务（连接管理、音频处理、结果回调），21个测试用例全部通过，性能测试达标

### 2026-02-22 16:08
#### 版本号：v0.2.106，更新：
- Prompt列表未读状态显示与自动标记功能：未读记录显示浅蓝色背景，点击自动标记为已读，后端新增isRead字段查询和标记接口

### 2026-02-22 12:00
#### 版本号：v0.2.105，更新：
- 实时语音识别功能文档：创建WebSocket实时语音识别实施方案、TDD实施指南和接口文档，采用阿里云百炼ASR服务，实现医生语音实时转文字

### 2026-02-22 00:56
#### 版本号：v0.2.104，更新：
- 定时任务扩展：每日Prompt生成任务新增病情小结自动生成功能，现在每天7:00为所有在院患者生成诊断分析、诊疗计划补充和病情小结三种Prompt

### 2026-02-21 15:47
#### 版本号：v0.2.103，更新：
- 修复病程记录保存逻辑缺陷，后端接口统一返回数字ID，前端增加5层验证机制，解决修改时偶尔新增记录的问题

### 2026-02-21 22:30
#### 版本号：v0.2.102，更新：
- 修复医嘱同步判重逻辑，临时医嘱和长期医嘱增加RepeatIndicator字段区分判重，修复临时医嘱重复导入问题

### 2026-02-21
#### 版本号：v0.2.101，更新：
- 病历记录列表新增记录日期列（第2列，宽度120px），新增formatRecordDate方法格式化日期为MM-DD HH:mm格式
- 文档类型列设置宽度100px确保中文完整显示
- 同步更新package.json版本号至0.2.101
- 优化用户体验，方便快速查看病历时间信息

### 2026-02-21
#### 版本号：v0.2.100，更新：
- 更新软件版本号至v0.2.100

### 2026-02-21
#### 版本号：v0.2.100，更新：
- 更新软件版本号至v0.2.100

### 2026-02-20
#### 版本号：v0.2.0，更新：
- 修复开发环境Prompt列表数据加载错误（data.forEach报错）
- 修复Prompt详情页PromptId显示为N/A的问题
- 修复AI内容未显示的问题
- 修复生产环境Prompt列表为空的问题（后端代码已更新）
- 关于页面添加软件版本号显示（从package.json动态读取）
- 为PromptList.vue关键方法添加完整的JSDoc注释
- 更新package.json版本号至0.2.0

### 2026-02-15
#### 版本号：未指定，更新：
- 新增AI结果删除功能：添加deletePromptResult API接口（DELETE /api/ai/patientPromptResult/{resultId}）
- AIResults组件添加删除按钮和deleteResult方法
- AITabs和AIView组件添加事件传递和列表刷新逻辑
- 补充完整JSDoc注释
- 实现删除后自动刷新Prompt列表功能
